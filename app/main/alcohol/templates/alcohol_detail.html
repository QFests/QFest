{%- extends "base.html" -%}
{%- from "bootstrap/pagination.html" import render_pagination -%}
{%- import "bootstrap/wtf.html" as wtf -%}
{%- block mycontent -%}


    <h1 class="page-header animated fadeInLeft">{{ alcohol.title }}
        {%- if alcohol.subtitle -%}
        <!-- <small>{{ alcohol.subtitle }}</small> -->
        {%- endif -%}
    </h1>

		<div class = "container-fluid m-p-0 site-content">
			<div class = "row row-md-5" id = "product-row">
				<div class = "col col-md-5" id = "product-img-col">
					<div id = "product-image-container">
						{%- if alcohol.image -%}
						<img id="product-img" src="{{ alcohol.image }}" alt="{{ alcohol.title~' Cover' }}">
						{%- endif -%}
					</div>

				</div>

				<div class = "col col-md-7 m-p-0"  id = "product-col" >
					<div id = "product-info">
							<h4>ОПИС</h4>
					<ul class="list-group">
							<li class="list-group-item" id = "product-info-list-item">ISBN: {{ alcohol.isbn }}</li>
							{%- if alcohol.origin_title -%}
							<li class="list-group-item" id = "product-info-list-item">Original title: {{ alcohol.origin_title }}</li>
							{%- endif -%}
							{%- if alcohol.manufacturer -%}
							<li class="list-group-item" id = "product-info-list-item">Manufacturer: {{ alcohol.manufacturer }}</li>
							{%- endif -%}
							{%- if alcohol.translator -%}
							<li class="list-group-item" id = "product-info-list-item">Translator: {{ alcohol.translator }}</li>
							{%- endif -%}
							{%- if alcohol.distributor -%}
							<li class="list-group-item" id = "product-info-list-item">Publishing house : {{ alcohol.distributor }}</li>
							{%- endif -%}
							{%- if alcohol.pubdate -%}
							<li class="list-group-item" id = "product-info-list-item">Publication date : {{ alcohol.pubdate }}</li>
							{%- endif -%}
							{%- if alcohol.tags.count() -%}
							<li class="list-group-item" id = "product-info-list-item">Label:
									{% for tag in alcohol.tags %}
									<a class="tag line-wrap" href="{{ url_for('.tags',search=tag.name) }}">{{ tag.name }} <span
													class="badge">{{ tag.alcohols.count() }}</span></a>
									{% endfor %}
							</li>
							{%- endif -%}
							{%- if alcohol.pages -%}
							<li class="list-group-item">Number of pages : {{ alcohol.pages }}</li>
							{%- endif -%}
							{%- if alcohol.price -%}
							<li class="list-group-item">Pricing: {{ alcohol.price }}</li>
							{%- endif -%}
							{%- if alcohol.binding -%}
							<li class="list-group-item">Binding: {{ alcohol.binding }}</li>
							{%- endif -%}
							<li class="list-group-item">Collection/Available for buy: {{ alcohol.numbers }} / {{ alcohol.can_buy_number()
									}}
							</li>
					</ul>



					<div id = "product-short-description">
					{%- if alcohol.summary_html -%}
					{{ alcohol.summary_html|safe }}
					{%- else -%}
					{{ alcohol.summary }}
					{%- endif -%}
					</div>

					</div>
				</div>
			</div>
		</div>



    <!-- Tab panes -->
    <div class="tab-content">

        {%- if (request.args.get('show') or '0')=='0' -%}

        <ul class="list-group">
            {%- if current_user.is_authenticated -%}
            <li class="list-group-item list-group-item">
                <div class="row">
                    <div class="col-md-4 col-md-offset-4">
                        <button type="button" class="btn btn-primary btn-block" data-toggle="modal"
                                data-target="#myModal">
                            I will evaluate this alcohol
                        </button>
                    </div>
                </div>
            </li>
            {%- endif -%}
            {%- for comment in data -%}
            <li class="list-group-item clearfix">
                <div class="media">
                    {%- if comment.user.avatar_url() -%}
                    <div class="media-left">
                        <a href="{{ url_for('user.detail',user_id=comment.user.id) }}">
                            <div class="media-object avatar avatar-small"
                                 style="background-image: url({{ comment.user.avatar_url() }})"></div>
                        </a>
                    </div>
                    {%- endif -%}
                    <div class="media-body">
                        <p class="media-heading"><a
                                href="{{ url_for('user.detail',user_id=comment.user.id) }}">
                            {{ comment.user.name }}</a>
                            <small>{{ comment.user.headline or "" }}</small>
                        </p>
                        <p class="list-group-item-text">{{ comment.comment }}</p>
                        {%- if comment.create_timestamp==comment.edit_timestamp -%}
                        <h4>
                            <small>
                                Posted on: {{ comment.create_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</small>
                        </h4>
                        {%- else -%}
                        <h4>
                            <small>
                                Edited on : {{ comment.edit_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</small>
                        </h4>
                        {%- endif -%}

                        {%- if comment.user_id == current_user.id or current_user.can(Permission.DELETE_OTHERS_COMMENT)
                        -%}
                        <a class="pull-right btn btn-danger btn-sm"
                           href="{{ url_for('comment.delete',comment_id=comment.id,next=request.url) }}">Delete</a>
                        {%- endif -%}
                    </div>
                </div>
            </li>
            {%- endfor -%}
        </ul>


        {%- elif request.args.get('show')=='1' -%}
        {%- if data -%}
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>User name</th>
                <th class="hidden-xs">User email</th>
                <th>Purchase date</th>
                <th>Return date</th>
            </tr>
            </thead>
            <tbody>
            {%- for log in data -%}
            <tr>
                <td>
                    <a href="{{ url_for('user.detail' ,user_id=log.user.id) }}">{{ log.user.name }}</a>
                </td>
                <td class="hidden-xs">{{ log.user.email }}</td>

                <td>{{ log.buy_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</td>
                <td>{{ log.return_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</td>
            </tr>
            {%- endfor -%}
            </tbody>
        </table>
        {%- else -%}
        <div class="container-fluid">No information</div>
        {%- endif -%}
        {%- else -%}
        {%- if data -%}
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>User name</th>
                <th class="hidden-xs">User email</th>
                <th>Purchase date</th>
                <th>Return date</th>
            </tr>
            </thead>
            <tbody>
            {%- for log in data -%}
            <tr>
                <td>
                    <a href="{{ url_for('user.detail' ,user_id=log.user.id) }}">{{ log.user.name }}</a>
                </td>
                <td class="hidden-xs">{{ log.user.email }}</td>

                <td>{{ log.buy_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</td>
                <td>{{ log.return_timestamp.strftime('%d %B %Y - %H:%M:%S') }}</td>
            </tr>
            {%- endfor -%}
            </tbody>
        </table>
        {%- else -%}
        <div class="container-fluid">No information</div>
        {%- endif -%}

        {%- endif -%}
    </div>

    {%- if pagination and pagination.pages > 1 -%}
    <div class="container-fluid text-center">
        {{ render_pagination(pagination,args={'_anchor':'log'}) }}
    </div>
    {%- endif -%}
    {%- endblock -%}
